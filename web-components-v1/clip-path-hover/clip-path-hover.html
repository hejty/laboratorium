<template id="clip-path-hover">
    <style>
        :host {
            --clip-background: #39205b;
            --clip-color: #17e1e3;
            --custom-easing: cubic-bezier(0.25, 0.46, 0.45, 0.94);
            --transition-timing: 200ms;
            display: block;
            height: 100%;
            width: 100%;
        }

        main {
            height: 100%;
        }

        .clipped-boxes {
            display: flex;
            flex-flow: row wrap;
            justify-content: center;
        }

        .clipped-box {
            background-color: var(--clip-background);
            cursor: pointer;
            display: flex;
            flex: 1;
            height: 50vh;
            justify-content: center;
            overflow: hidden;
            position: relative;
            will-change: transform;
        }

        .clipped-box:hover circle,
        .clipped-box:hover image {
            transform: scale(1);
        }

        svg {
            height: 100%;
            left: 0;
            position: absolute;
            top: 0;
            width: 100%;
        }

        circle {
            transform: scale(0);
            transform-origin: 50% 50%;
            transition: transform var(--transition-timing) var(--custom-easing);
        }

        text {
            font-size: 1rem;
            text-anchor: middle;
        }

        .svg-text {
            fill: var(--clip-color);
        }

        .svg-masked-text {
            fill: white;
        }

        image {
            transform-origin: 50% 50%;
            transition: transform var(--transition-timing) var(--custom-easing);
        }
    </style>

    <main>

        <div class="clipped-boxes">

            <div class="clipped-box">
                <svg id="svg-1" preserveAspectRatio="xMidYMid slice" viewBox="0 0 300 300">
                    <defs>
                        <clipPath id="clip-1">
                            <circle cx="0" cy="0" r="150px"></circle>
                        </clipPath>
                    </defs>
                    <text class="svg-text" dy="0.35em" x="50%" y="50%">
                        Clip 1
                    </text>
                    <g clip-path="url(#clip-1)">
                        <image height="100%" preserveAspectRatio="xMinYMin slice" width="100%" xlink:href="http://placehold.it/2000/005397/ffffff/?text=1"></image>
                        <text class="svg-masked-text" dy="0.35em" x="50%" y="50%">
                            Clip 1
                        </text>
                    </g>
                </svg>
            </div>

            <div class="clipped-box">
                <svg id="svg-2" preserveAspectRatio="xMidYMid slice" viewBox="0 0 300 300">
                    <defs>
                        <clipPath id="clip-2">
                            <circle cx="0" cy="0" r="150px"></circle>
                        </clipPath>
                    </defs>
                    <text class="svg-text" dy="0.35em" x="50%" y="50%">
                        Clip 2
                    </text>
                    <g clip-path="url(#clip-2)">
                        <image height="100%" preserveAspectRatio="xMinYMin slice" width="100%" xlink:href="http://placehold.it/2000/32b67a/ffffff/?text=2"></image>
                        <text class="svg-masked-text" dy="0.35em" x="50%" y="50%">
                            Clip 2
                        </text>
                    </g>
                </svg>
            </div>

            <div class="clipped-box">
                <svg id="svg-3" preserveAspectRatio="xMidYMid slice" viewBox="0 0 300 300">
                    <defs>
                        <clipPath id="clip-3">
                            <circle cx="0" cy="0" r="150px"></circle>
                        </clipPath>
                    </defs>
                    <text class="svg-text" dy="0.35em" x="50%" y="50%">
                        Clip 3
                    </text>
                    <g clip-path="url(#clip-3)">
                        <image height="100%" preserveAspectRatio="xMinYMin slice" width="100%" xlink:href="http://placehold.it/2000/bfb5d7/ffffff/?text=3"></image>
                        <text class="svg-masked-text" dy="0.35em" x="50%" y="50%">
                            Clip 3
                        </text>
                    </g>
                </svg>
            </div>

        </div>

    </main>

</template>

<script>
    (function() {
        'use strict';

        const owner = document.currentScript.ownerDocument;
        const template = owner.querySelector('template');
        const content = template.content.cloneNode(true);

        class ClipPathHover extends HTMLElement {
            constructor() {
                super();

                this._shadowRoot = this.attachShadow({
                    mode: 'open'
                });

                this._shadowRoot.appendChild(content);
            }

            static get observedAttributes() {
                return [''];
            }

            connectedCallback() {
                this._clippedBoxes = [...this._shadowRoot.querySelectorAll('.clipped-box')];
                this._clippedBoxes.forEach((box, index) => box.addEventListener('mousemove', () => this._mouseMoveHandler(event, index)));
            }

            _mouseMoveHandler(event, index) {
                let i = index + 1;

                let svg = this._shadowRoot.querySelector(`#svg-${i}`);
                let clip = svg.querySelector('circle');
                let point = svg.createSVGPoint();

                this.update(clip, this.getCoordinates(event, svg, point));
            }

            update(clip, c) {
                clip.setAttribute('cx', c.x);
                clip.setAttribute('cy', c.y);
            }

            getCoordinates(event, svg, point) {
                point.x = event.clientX;
                point.y = event.clientY;
                return point.matrixTransform(svg.getScreenCTM().inverse());
            }

            disconnectedCallback() {
                this._clippedBoxes.forEach(item => item.removeEventListener('mousemove', () => this._mouseMoveHandler()));
            }

            attributeChangedCallback(attrName, oldVal, newVal) {}

            _selectElement(selector) {
                return this._shadowRoot.querySelector(selector);
            }
        }

        window.customElements.define('clip-path-hover', ClipPathHover);
    }());
</script>
