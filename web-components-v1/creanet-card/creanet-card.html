<template id="creanet-card">
    <style>
        :host {
            --card-bg: #123456;
            --card-color: white;
            --card-width: 80vw;
            --card-height: calc(var(--card-width) * 0.5);
            display: inline-block;
        }

        #card {
            background: var(--card-bg);
            height: var(--card-height);
            width: var(--card-width);
        }

        #card-back {
            backface-visibility: hidden;
            display: none;
            visibility: hidden;
        }

        #card-front {
            display: flex;
            flex: 1;
            flex-direction: row;
            height: 100%;
            visibility: visible;
        }

        #contacts {
            background: pink;
            box-sizing: border-box;
            color: var(--card-color);
            display: flex;
            flex-direction: column;
            height: 100%;
            line-height: 1.5;
            padding: 5vw;
            width: 50%;
        }

        a {
            color: var(--card-color);
            cursor: pointer;
            transition: all 300ms;
        }

        a:active,
        a:focus,
        a:hover {
            text-decoration: none;
        }

        #qr {
            box-sizing: border-box;
            float: right;
            width: 50%;
        }

        h1,
        h2,
        h3,
        h4,
        main,
        figure {
            margin: 0;
            padding: 0;
        }

        [center] {
            align-items: center;
            display: flex;
            justify-content: center;
        }
    </style>

    <main id="card">
        <section id="card-back">
            <figure>
                <svg id="creanet-logo" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 197.3 38.6">
                    <path fill="#2683C6" d="M11 16.2S8.2 15 6.7 18c0 0-.7 1.4.2 3 0 0 .7 1.2 2 1.6 0 0 1.3.4 2.2-.1l6.3 6.3s1.3 1.3 3 1.2c1.7-.1 2-.4 3-1.5s6.1-5.9 6.4-6.3h7.8L22.1 37.4s-.9 1.1-3 1.2c-2.1 0-3.1-1.8-3.2-1.7L1 22s-2.3-2.7.2-5.5L16.4 1.2s2.8-2.8 5.9.1l15.1 15.1h-7.8L23 9.9s-2.6-2.7-5.7 0L11 16.2z"/><g fill="#FFF"><path d="M61.7 30.4c-2 .8-4.3 1.1-6.8 1.1-8.3 0-12.5-4-12.5-12.1C42.5 11.8 46.6 8 54.9 8c2.5 0 4.8.4 6.8 1.1V13c-2-.9-4.2-1.3-6.5-1.3-5.6 0-8.3 2.6-8.3 7.7 0 5.6 2.8 8.3 8.3 8.3 2.3 0 4.5-.4 6.5-1.3v4zM65.8 31.3V8.2h10.5c4.7 0 7.1 2.1 7.1 6.2 0 2.8-1.8 5.1-5.5 6.9l7.3 10h-5.6l-7-10.1v-2c4.2-.7 6.3-2.3 6.3-4.8 0-1.7-1-2.6-2.9-2.6h-5.9v19.3h-4.3zM103.2 8.2v3.7H92.3v5.8h10.4v3.8H92.2v6.1h11.2v3.7H88V8.2h15.2zM106 31.3l9.8-23.1h4.6l10 23.1h-4.6L123 25h-7.4l1.5-3.7h4.8l-3.8-8.7-7.6 18.7H106zM133.3 31.3V8.2h2.2L151 28.3V8.2h1.5v23.1h-1.4l-16.3-21.2v21.2h-1.5zM172.6 8.2v1.5h-13.5v9.2H172v1.5h-12.9v9.5h13.7v1.5h-15.4V8.2h15.2zM192.2 8.2v1.5h-7.9v21.7h-1.7V9.7h-7.8V8.2h17.4z"/></g>
                </svg>
            </figure>
        </section>

        <section id="card-front">
            <summary id="contacts">
                <h2 id="name"></h2>
                <strong id="position"></strong>
                <slot></slot>

                <h3 id="phone"></h3>
                <a id="email"></a>
                <a id="www" href="http://www.creanet.sk/" target="_blank" rel="noopener noreferrer">www.creanet.sk</a>
            </summary>

            <figure id="qr" center>
                <qr-code></qr-code>
            </figure>
        </section>
    </main>
</template>

<script>
    (function() {
        'use strict';

        const owner = document.currentScript.ownerDocument;
        const template = owner.querySelector('template');
        const content = template.content.cloneNode(true);

        class CreanetCard extends HTMLElement {
            constructor() {
                super();

                this._shadowRoot = this.attachShadow({ mode: 'open' });
                this._shadowRoot.appendChild(content);

                this.name = this.getAttribute('name');
                this.phone = this.getAttribute('phone');
                this.position = this.getAttribute('position');
            }

            static get observedAttributes() {
                return ['name', 'phone', 'position'];
            }

            get name() {
                return this.hasAttribute('name');
            }

            set name(val) {
                if (val) {
                    this._name = val;
                    this._updateContent('name', val);
                    this._madeEmailFromName(val);
                }
            }

            get phone() {
                return this.hasAttribute('phone');
            }

            set phone(val) {
                if (val) {
                    this._phone = val;
                    this._updateContent('phone', val);
                }
            }

            get position() {
                return this.hasAttribute('position');
            }

            set position(val) {
                if (val) {
                    this._position = val;
                    this._updateContent('position', val);
                }
            }

            connectedCallback() {

            }

            disconnectedCallback() {

            }

            attributeChangedCallback(attrName, oldVal, newVal) {
                if (newVal !== oldVal && oldVal !== null) {
                    console.info(`${attrName}: ${oldVal} ———→ ${newVal}`);

                    switch (attrName) {
                        case 'name':
                            this._name = newVal;
                            this._madeEmailFromName(newVal);

                        case 'phone':
                            this._phone = newVal;

                        case 'position':
                            this._position = newVal;

                        default:
                            break;
                    }

                    this._updateContent(attrName, newVal);
                }
            }

            _madeEmailFromName(name) {
                if (name) {
                    const [firstName, lastName] = name.split(' ');
                    const pureName = lastName.normalize('NFD').replace(/[\u0300-\u036f]/g, '');
                    const lowerName = pureName.toLowerCase();
                    const email = `${lowerName}@creanet.sk`;
                    const emailEl = this._findElement('email');

                    emailEl.href = `mailto:${email}`;
                    emailEl.textContent = email;
                }
            }

            _findElement(ele) {
                return this._shadowRoot.getElementById(ele);
            }

            _updateContent(ele, val) {
                return this._findElement(ele).textContent = val;
            }
        }

        window.customElements.define('creanet-card', CreanetCard);
    }());
</script>
