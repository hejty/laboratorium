<template id="creanet-card">
    <style>
        :host {
            --card-bg: #123456;
            --card-color: white;
            --card-width: 80vw;
            --card-height: calc(var(--card-width) * 0.5);
            display: inline-block;
        }

        #card {
            background: var(--card-bg);
            height: var(--card-height);
            width: var(--card-width);
        }

        #card-back {
            backface-visibility: hidden;
            display: none;
            justify-content: center;
            visibility: hidden;
        }

        #card-front {
            display: flex;
            flex: 1;
            flex-direction: row;
            height: 100%;
            visibility: visible;
        }

        #contacts {
            background: pink;
            box-sizing: border-box;
            color: var(--card-color);
            display: flex;
            flex-direction: column;
            height: 100%;
            line-height: 1.5;
            padding: 5vw;
            width: 50%;
        }

        a {
            color: var(--card-color);
            cursor: pointer;
            transition: all 300ms;
        }

        a:active,
        a:focus,
        a:hover {
            text-decoration: none;
        }

        #qr {
            box-sizing: border-box;
            float: right;
            width: 50%;
        }

        h1,
        h2,
        h3,
        h4,
        main,
        figure {
            margin: 0;
            padding: 0;
        }

        [center] {
            align-items: center;
            display: flex;
            justify-content: center;
        }

        ::slotted(img) {
            width: 75%;
        }
    </style>

    <main id="card">
        <section id="card-back">
            <slot name="logo"></slot>
        </section>

        <section id="card-front">
            <summary id="contacts">
                <h2 id="name"></h2>
                <strong id="position"></strong>
                <slot></slot>

                <h3 id="phone"></h3>
                <a id="email"></a>
                <a id="www" href="http://www.creanet.sk/" target="_blank" rel="noopener noreferrer">www.creanet.sk</a>
            </summary>

            <figure id="qr" center>
                <qr-code></qr-code>
            </figure>
        </section>
    </main>
</template>

<script>
    (function() {
        'use strict';

        const owner = document.currentScript.ownerDocument;
        const template = owner.querySelector('template');
        const content = template.content.cloneNode(true);

        class CreanetCard extends HTMLElement {
            constructor() {
                super();

                this._shadowRoot = this.attachShadow({ mode: 'open' });
                this._shadowRoot.appendChild(content);

                this.name = this.getAttribute('name');
                this.phone = this.getAttribute('phone');
                this.position = this.getAttribute('position');
            }

            static get observedAttributes() {
                return ['name', 'phone', 'position'];
            }

            get name() {
                return this.hasAttribute('name');
            }

            set name(val) {
                if (val) {
                    this._name = val;
                    this._updateContent('name', val);
                    this._madeEmailFromName(val);
                }
            }

            get phone() {
                return this.hasAttribute('phone');
            }

            set phone(val) {
                if (val) {
                    this._phone = val;
                    this._updateContent('phone', val);
                }
            }

            get position() {
                return this.hasAttribute('position');
            }

            set position(val) {
                if (val) {
                    this._position = val;
                    this._updateContent('position', val);
                }
            }

            connectedCallback() {

            }

            disconnectedCallback() {

            }

            attributeChangedCallback(attrName, oldVal, newVal) {
                if (newVal !== oldVal && oldVal !== null) {
                    console.info(`${attrName}: ${oldVal} ———→ ${newVal}`);

                    switch (attrName) {
                        case 'name':
                            this._name = newVal;
                            this._madeEmailFromName(newVal);

                        case 'phone':
                            this._phone = newVal;

                        case 'position':
                            this._position = newVal;

                        default:
                            break;
                    }

                    this._updateContent(attrName, newVal);
                }
            }

            _madeEmailFromName(name) {
                if (name) {
                    const [firstName, lastName] = name.split(' ');
                    const pureName = lastName.normalize('NFD').replace(/[\u0300-\u036f]/g, '');
                    const lowerName = pureName.toLowerCase();
                    const email = `${lowerName}@creanet.sk`;
                    const emailEl = this._findElement('email');

                    emailEl.href = `mailto:${email}`;
                    emailEl.textContent = email;
                }
            }

            _findElement(ele) {
                return this._shadowRoot.getElementById(ele);
            }

            _updateContent(ele, val) {
                return this._findElement(ele).textContent = val;
            }
        }

        window.customElements.define('creanet-card', CreanetCard);
    }());
</script>
